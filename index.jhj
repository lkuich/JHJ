<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Home</title>
  </head>

  <script>
    window.onload = async function() {
      async function handleSubmit(e) {
        const formData = new FormData(e.target);
        const data = {};
        for (var [key, value] of formData.entries()) {
          data[key] = value;
        }

        // Submit my form data to the server
        const c = await handleFormSubmit(data.name, data.email)
        console.log(c)
      }

      const form = document.getElementById('form');
      form.addEventListener('submit', handleSubmit);
    }
  </script>

  <script serverside>
    function handleFormSubmit(name, email) {
      console.log(`My name is: ${name} and my email is: ${email}`);
      return 'Successfully logged in!';
    }

    console.log('loaded')

    module.exports = {
      handleFormSubmit
    };
  </script>

  <body>
    <p>Hello world</p>
    <form id="form" onsubmit="return false;">
      <input type="text" name="name" placeholder="Name">
      <input type="text" name="email" placeholder="Email">
      <button type="submit">Submit</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      socket.on('modules', function({ functions }) {
        functions.forEach(func => {
          eval(`window.${func} = function ${func}() {
            socket.emit('jsMethodCall', { method: '${func}', args: Object.values(arguments) });
            
            return new Promise((resolve, reject) => {
              socket.on('${func}Response', function({ response }) {
                resolve(response);
              });
            });
          };`)
        });
      });
    </script>
  </body>

</html>